import { rmdirSync as e, mkdirSync as t, writeFileSync as n, readFileSync as r }from 'fs'; import { resolve as o }from 'path'; import { get as s }from 'https'; const i = e => 'x' + (JSON.stringify(e).split('').map(e=>e.charCodeAt(0)).reduce((e,t)=>(e<<5)-e+t|0, 0) >>> 0).toString(36); const a=({a:e={},c:t=[]})=>(e.styles||[]).concat(...t.map((e=>a(e)))); const l=e=>{if(!e)return"";const t=(n=a(e),Array.from(new Set(n)));var n;const r=[];return t.forEach((e=>{const t="."+i(e);const n=[],o=[],s={};Object.entries(e).forEach((([e,r])=>{const i=e.charAt(0);"@"===i?o.push(`${e}{${c(t,"",r)}}`):":"===i?n.push(c(t,e,r)):s[e]=r}));const a=c(t,"",s);a&&r.push(a),r.push(...n,...o)})),r.join(" ")}; const c=(e,t,n)=>{const r=Object.keys(n);if(!r.length)return"";return`${e}${t}{${r.map((e=>`${e}:${n[e]}`)).join(";")}}`}; const m=e=>{if(!e||!e.a)return e;const{styles:t=[],class:n="",...r}=e.a,o=t.map((e=>i(e))),s=[...n.split(" "),...o].filter((e=>Boolean(e.trim()))).join(" "),a={...r};return s&&(a.class=s),{n:e.n,a:a,c:e.c.map((e=>m(e)))}}; const p=[[/&/g,"&#38;"],[/\//g,"&#47;"],[/</g,"&#60;"],[/>/g,"&#62;"],[/'/g,"&#39;"],[/"/g,"&#34;"]]; const u=e=>{const t="string"==typeof e;return"number"==typeof e&&!Number.isNaN(e)||t}; const g=["area","base","br","col","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"]; const f=["script","style"]; const d=["src","href"]; const h=e=>{if(e&&e.n){const{n:t,a:n,c:r}=e,o=b(n);return g.includes(t)?`<${t}${o}>`:f.includes(t)?`<${t}${o}>${r.map((e=>""+e)).join("")}</${t}>`:`<${t}${o}>${r.map((e=>h(e))).join("")}</${t}>`}return u(e)?(t=""+e,p.reduce(((e,t)=>e.replace(t[0],t[1])),t)):"";var t}; const b=e=>Object.keys(e).filter((e=>0!==e.indexOf("on"))).map((t=>" "+w(t,e[t]))).filter((e=>Boolean(e.trim()))).join(""); const w=(e,t)=>d.includes(e)?`${e}="${t}"`:u(t)?`${e}="${(e=>e.split("").map((e=>{const t=e.charCodeAt();return t>=65&&t<=90||t>=97&&t<=122||t>=48&&t<=57?e:`&#${t};`})).join(""))(""+t)}"`:!0===t?""+e:""; const y=[[/&/g,"&#38;"],[/\//g,"&#47;"],[/</g,"&#60;"],[/>/g,"&#62;"],[/'/g,"&#39;"],[/"/g,"&#34;"]]; const x=e=>{const t="string"==typeof e;return"number"==typeof e&&!Number.isNaN(e)||t}; const $=["src","href"]; const z=e=>{if(e&&e.n){const{n:t,a:n,c:r}=e,o=v(n);return r.length>0?`<${t}${o}>${r.map((e=>z(e))).join("")}</${t}>`:`<${t}${o} />`}return x(e)?(t=""+e,y.reduce(((e,t)=>e.replace(t[0],t[1])),t)):"";var t}; const v=e=>Object.keys(e).map((t=>" "+k(t,e[t]))).filter((e=>Boolean(e.trim()))).join(""); const k=(e,t)=>$.includes(e)?`${e}="${t}"`:x(t)?`${e}="${(e=>e.split("").map((e=>{const t=e.charCodeAt();return t>=65&&t<=90||t>=97&&t<=122||t>=48&&t<=57?e:`&#${t};`})).join(""))(""+t)}"`:""; const A=/<\?xml.+?>\s*/i; const S=/^<(?:([a-zA-Z][-a-zA-Z0-9]*):)?([a-zA-Z][-a-zA-Z0-9]*)((?:\s+[-:\w]+(?:\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|[^>\s]+))?)*)\s*(\/?)>/; const U=/^<\/(?:([a-zA-Z][-a-zA-Z0-9]*):)?([a-zA-Z][-a-zA-Z0-9]*)[^>]*>/; const j=/([a-zA-Z][-:a-zA-Z0-9]*)(?:\s*=\s*(?:(?:"((?:\\.|[^"])*)")|(?:'((?:\\.|[^'])*)')|([^>\s]+)))?/g; const C=/([a-zA-Z][-:a-zA-Z0-9]*)(?:="((?:\\.|[^"])*)")?/; const T=/^(<!--[\s\S]*?-->)/; const O=/^\s+?(?:(?=<)|(?:$))/; const Z=/^([\s\S]+?)(?:(?=<)|(?:$))/; const P=/^<!\[CDATA\[([\s\S]*?)]]>/; const E=e=>e[e.length-1]; const L=(e,t,n,r)=>{const o=[...e].reverse().findIndex((e=>e.s===t&&e.n===n));if(!(o>-1))throw new Error(`Unexpected </${n}> at ${r.slice(0,80)}...`);e.length=e.length-o-1}; const N=e=>{let t=null;const n=[];for(;e;){let r=null;if(r=e.match(S)){const o=r[1]?r[1].toLowerCase():"",s=r[2].toLowerCase(),i=(r[3].trim().match(j)||[]).reduce(((e,t)=>{const n=t.match(C);if(n){const t=n[1],r=n[2];e[t]=r}return e}),{}),a=!!r[4],l={s:o,n:s,a:i,c:[]};if(n.length)E(n).c.push(l);else{if(t)throw new Error(`There are multiple root elements at ${e.slice(0,80)}...`);t=l}a||n.push(l)}else if(r=e.match(U)){const t=r[1]?r[1].toLowerCase():"",o=r[2].toLowerCase();L(n,t,o,e)}else if(r=e.match(A));else if(r=e.match(T));else if(r=e.match(O));else if(r=e.match(P)){if(!n.length)throw new Error(`Unexpected syntax at ${e.slice(0,80)}...`);E(n).c.push(r[1])}else{if(!(r=e.match(Z)))throw new Error(`Unexpected syntax at ${e.slice(0,80)}...`);if(!n.length)throw new Error(`Unexpected syntax at ${e.slice(0,80)}...`);E(n).c.push(r[1])}e=e.slice(r[0].length)}return t}; const I=e=>`${"string"==typeof e?e:""}${e.c?e.c.map((e=>I(e))).join(""):""}`; const D=(e,t)=>e.c?e.c.find(t):null; const B=(e,t)=>{if(e.n&&t(e))return e;if(e.c)for(const n of e.c){const e=B(n,t);if(e)return e}return null}; const M=(e,t)=>[...e.n&&t(e)?[e]:[],...e.c?e.c.flatMap((e=>M(e,t))):[]]; const R=(e,t)=>e.n?t({...e,c:e.c.map((e=>R(e,t)))}):e; const q={}; const F=()=>{}; const H=e=>(...t)=>{const[n,r]=((...e)=>2===e.length?e:Array.isArray(e[0])?[{},e[0]]:e[0]?[e[0],[]]:[{},[]])(...t);return{n:e.toLowerCase(),a:n,c:r.filter((e=>0===e||e&&!0!==e))}}; const J=new Proxy({},{get:(e,t)=>"string"!=typeof t?F:q[t]?q[t]:q[t]=H(t)}); const X=[[/&quot;/g,'"'],[/&apos;/g,"'"],[/&gt;/g,">"],[/&lt;/g,"<"],[/&sol;/g,"/"],[/&amp;/g,"&"]]; const _=e=>X.reduce(((e,t)=>e.replace(t[0],t[1])),e).replace(/&#(\d+);/g,((e,t)=>String.fromCharCode(t))).replace(/&#[xX]([0-9a-fA-F]+);/g,((e,t)=>String.fromCharCode(parseInt(""+t,16)))); const G=e=>({position:e}); const K=e=>({"padding-top":e}); const Q=e=>({"padding-bottom":e}); const V=e=>({"padding-left":e}); const W=e=>({"padding-right":e}); const Y=e=>({"margin-bottom":e}); const ee=e=>({"margin-left":e}); const te=e=>({"margin-right":e}); const ne=(...e)=>({styles:e.filter(Boolean)}); const  re = { color: '#343a40' }; const oe = (e => ({ 'font-size': e }))('1.000rem'); const se=(e=>({"line-height":e}))("1.5"); const ie=(e=>({"font-family":e}))("-apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Helvetica Neue, Arial, sans-serif, Apple Color Emoji, Segoe UI Emoji"); const ae=(e=>({"text-decoration":e}))("none"); const le=(e=>({"text-rendering":e}))("optimizeLegibility"); const ce=K("0"); const me=W("0"); const pe=Q("0"); const ue={...V("0"),...me,...ce,...pe}; const ge=K("1rem"); const fe=W("1rem"); const de=Q("1rem"); const he={...V("1rem"),...fe,...ge,...de}; const be=(e=>({"margin-top":e}))("0"); const we=te("0"); const ye=Y("0"); const xe={...ee("0"),...we,...be,...ye}; const $e=Y("0.5rem"); const ze=Y("1rem"); const ve=ee("2rem"); const ke={...ee("auto"),...te("auto")}; const Ae={...(e=>({"list-style-type":e}))("none"),...xe,...ue}; const Se=(e=>({"max-width":e}))("768px"); const Ue=G("relative"); const je=G("absolute"); const {ul:Ce,li:Te,p:Oe,small:Ze,header:Pe,h1:Ee,body:Le,head:Ne,html:Ie,link:De,meta:Be,style:Me,title:Re,div:qe,a:Fe}=J; const He=e=>new Date(e).toLocaleString("en-US",{timeZone:"UTC",hour12:!1,timeZoneName:"short"}); const Je={cursor:"help"}; const Xe=(e,t)=>{const n=e-t;return n>31556952e3?(n/31556952e3|0)+"y":n>2629746e3?(n/2629746e3|0)+"mo":n>6048e5?(n/6048e5|0)+"w":n>864e5?(n/864e5|0)+"d":n>36e5?(n/36e5|0)+"h":n>6e4?(n/6e4|0)+"m":n>1e3?(n/1e3|0)+"s":n}; const _e="\n  /*! normalize.css v8.0.0 | MIT License | github.com/necolas/normalize.css */\n  html{line-height:1.15;-webkit-text-size-adjust:100%}body{margin:0}h1{font-size:2em;margin:.67em 0}hr{box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,samp{font-family:monospace,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{padding:.35em .75em .625em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{vertical-align:baseline}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details{display:block}summary{display:list-item}template{display:none}[hidden]{display:none}\n".replace(/\s+/g," "); const {feed:Ge,id:Ke,title:Qe,updated:Ve,entry:We,link:Ye}=J; const {head:et,style:tt}=J; const nt=e=>"<!doctype html>"+h(e); const rt=e=>l(e); const ot=e=>{if(!e)throw new Error("Root cannot be a non-object");return'<?xml version="1.0" encoding="utf-8"?>'+z(e)}; const  st = async ({ name: r, homepage: i, urls: a, directory: l, plugins: c }) => { const p = Date.now(); const u=await(async(e,t)=>{const n=[];for(const[r,o]of e.entries())n.push(await t(o,r,e));return n})(a,(async e=>{return t=e,new Promise(((e,n)=>{s(t,(t=>{let n="";t.on("data",(e=>{n+=e})),t.on("end",(()=>{e(n)}))})).on("error",(e=>{n(e)}))}));var t})); const  g = { name: r, homepage: i, items: Array.from(u.map((e,t)=>{const n=N(e),r=c.find((e=>e.canProcess(a[t],n)));return{data:n,plugin:r}}).filter(({data:e,plugin:t})=>e&&t).flatMap(({data:e,plugin:t})=>t.process(e)).filter(e=>e.timestamp>p-6048e5).filter(e=>(e=>{try{return new URL(e).toString(),!0}catch(e){return!1}})(e.url)).filter(e=>0===e.url.indexOf("https://")).reduce((e,t)=>e.set(t.url,t), new Map()).values()).sort((e,t)=>t.timestamp-e.timestamp).map(e=>({...e,title:_(e.title).replace(/(?:\r\n|\r|\n)+/g," ")})), timestamp: p }; var f; e(l, { recursive: !0 }), t(l, { recursive: !0 }), n(o(l, 'index.html'), nt((f = (({ name: e, homepage: t, items: n, timestamp: r }) => Ie({ lang: 'en', ...ne({ 'font-size': '16px' }) }, [Ne([Be({ charset: 'utf-8' }), Be({ name: 'viewport', content: 'width=device-width, initial-scale=1, shrink-to-fit=no' }), Be({ name: 'canonical', content: t }), Be({ name: 'referrer', content: 'no-referrer' }), Be({ 'http-equiv': 'Content-Security-Policy', content: "default-src 'self'; style-src 'unsafe-inline'; base-uri 'none'; form-action 'none'" }), Re([e]), De({ rel: 'alternate', type: 'application/atom+xml', title: e, href: 'feed.xml' }), De({ rel: 'icon', type: 'image/x-icon', href: 'data:,' }), Me({ type: 'text/css' }, [_e])]), Le({ ...ne(le, se, ie, oe, re) }, [qe({ ...ne(Se, ke, he) }, [Pe([Ee({ ...ne(ze) }, [e]), Oe([Ze([`This page was generated on ${He(r)}.`])])]), Ce({ ...ne(Ae) }, n.map(({title:e,url:t,timestamp:n})=>{return Te({...ne(Ue,$e)},[qe({...ne(je)},[Ze({...ne(Je),title:(o=r,"This time is relative to "+He(o))},[Xe(r,n)])]),qe({...ne(ve)},[Fe({href:t,target:"_blank",...ne(ae)},[e])])]);var o}))])])]))(g), m(R(f, e=>"head"!==e.n?e:et(e.a,[...e.c,tt({type:"text/css"},[rt(f)])])))))), n(o(l, 'feed.xml'), ot((({ name: e, homepage: t, items: n, timestamp: r }) => Ge({ xmlns: 'http://www.w3.org/2005/Atom' }, [Ke([t]), Qe([e]), Ye({ rel: 'self', href: '/feed.xml' }), Ye({ rel: 'alternate', href: t }), Ve([new Date(r).toISOString()]), ...n.map(e=>We([Ke([e.url]),Qe([e.title]),Ve([new Date(e.timestamp).toISOString()])]))]))(g))) }; class it extends Error {constructor (e) { super(e), this.name = 'ImplementationMissingError' }} class at {canProcess (e, t) { throw new it() }process (e) { throw new it() }getTitle (e) { throw new it() }getTimestamp (e) { throw new it() }getUrl (e) { throw new it() }} class lt extends at {canProcess (e, t) { return 'feed' === t.n }process (e) { return e.c.filter(e=>"entry"===e.n).map(e=>({title:this.getTitle(e),timestamp:this.getTimestamp(e),url:this.getUrl(e)})) }getTitle (e) { const t = D(e, e=>"title"===e.n); return t ? I(t):'' }getTimestamp (e) { const t = D(e, e=>"updated"===e.n); return t ? new Date(I(t)).valueOf():'' }getUrl (e) { const t = D(e, e=>"id"===e.n); return t ? I(t):'' }} class ct extends at {canProcess (e, t) { return 'rss' === t.n && '2.0' === t.a.version }process (e) { return e.c.find(e=>"channel"===e.n).c.filter(e=>"item"===e.n).map(e=>({title:this.getTitle(e),timestamp:this.getTimestamp(e),url:this.getUrl(e)})) }getTitle (e) { const t = D(e, e=>"title"===e.n); return t ? I(t):'' }getTimestamp (e) { const t = D(e, e=>"pubdate"===e.n); return t ? new Date(I(t)).valueOf():'' }getUrl (e) { const t = D(e, e=>"link"===e.n); return t ? I(t):'' }} class mt extends lt {canProcess (e, t) { return e.indexOf("https://www.reddit.com")===0 && super.canProcess(e, t) }getUrl (e) { const t = D(e, e=>"content"===e.n&&"html"===e.a.type); if (t) { const e = I(t).match(/&lt;span&gt;&lt;a href=&quot;(.+?)&quot;&gt;\[link\]&lt;\/a&gt;&lt;\/span&gt;/); return e ? e[1]:'' }return '' }} class pt extends ct {canProcess (e, t) { return e.indexOf("https://medium.com")===0 && super.canProcess(e, t) }getUrl (e) { const t = D(e, e=>"link"===e.n); if (t) { const e = new URL(I(t)); return e.search = '', e.toString() }return '' }} class ut extends ct {canProcess (e, t) { return e.indexOf("https://www.phoronix.com")===0 && super.canProcess(e, t) }getUrl (e) { const t = D(e, e=>"link"===e.n); if (t) { const e = new URL(I(t)); return e.protocol = 'https:', e.toString() }return '' }} var gt; (gt = { async build () { const e = o(process.cwd(), 'urls.opml'); const t=(e=>{const t=N(e);return{name:I(B(t,(e=>"title"===e.n))),homepage:I(B(t,(e=>"ownerid"===e.n))),urls:M(t,(e=>"outline"===e.n&&"rss"===e.a.type&&e.a.xmlUrl)).map((e=>e.a.xmlUrl))}})(r(e,{encoding:"utf8"})); const n=o(process.cwd(),"public"); const  s = [mt, pt, ut, lt, ct].map(e=>new e); await st({ ...t, directory: n, plugins: s }) } }, async e => { const t = e[2]; gt[t] && gt[t]({}, e.slice(3)) })(process.argv).catch(e=>{console.warn(e),process.exitCode=1})
